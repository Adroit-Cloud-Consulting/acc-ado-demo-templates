# Adroit Cloud Consulting
# File: template-create-repo.yml

parameters:
  subscription: ''
  repo_name: ''
  ado_org: ''
  project: ''


steps:
#Create Azure Repo
- task: AzureCLI@2
  displayName: 'Create Git Repository'
  inputs:
    azureSubscription: $(subscription)
    scriptType: 'pscore'
    scriptLocation: inlineScript
    inlineScript: |
        # Check and create new repo
        $repoCheck = (az repos show -r $(repo_name) --org $(ado_org) --project $(ado_project) | ConvertFrom-Json)

        if (!($repoCheck)) {
            Write-Host "##[warning]$(repo_name) doesnt exist creating..."
            az repos create --name $(repo_name) --org $(ado_org) --project $(ado_project)
        }
        else {
            Write-Host "##[section]Repository: $(repo_name) already exists!"
        }
  env:
    AZURE_DEVOPS_EXT_PAT: $(pat_token)