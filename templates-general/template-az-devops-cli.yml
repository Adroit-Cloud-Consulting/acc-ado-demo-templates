# File: template-az-devops-cli.yml

parameters:
  subscription: ''


steps:
#Check that the Azure Devops CLI is installed on the build agent
- task: AzureCLI@2
  displayName: 'Check az devops cli extension is installed'
  inputs:
    azureSubscription: $(subscription)
    scriptType: 'pscore'
    scriptLocation: inlineScript
    inlineScript: |
        $checkExtension = (az extension list-available --query "[? name=='azure-devops']" | ConvertFrom-Json)

        if (!($checkExtension)) {
            Write-Host "##[warning] Azure Devops Extension Not Installed... Installing"
            az extension add --name azure-devops
        } 
        else {
            Write-Host "##[section] Azure Devops Extension: $($checkExtension.version) already installed"
        }
  env:
    AZURE_DEVOPS_EXT_PAT: $(pat_token)